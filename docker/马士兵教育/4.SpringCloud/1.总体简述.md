##### 1.一个很大的项目到底是怎么做负载均衡的？

###### 1.1 单机房

假设一个机房的机器，能够满足需求，那么通常而言，这个机房会部署几个keepalive+lvs，如果项目没有很夸张的话，一般2个也就够了，因为lvs是ip层的负载均衡，速度足够快。

然后lvs后面就是流量网关，一般用nginx实现，lvs提供虚拟ip，所以多个nginx绑定到1个lvs的虚拟ip上。具体需要多少个nginx，这个看业务实际流量。通常来说，如果平均一个请求的数据包是1KB，而一台机器的网卡是100M，那么大约1个nginx可以处理1W个请求每秒。

流量网关后面跟着的是业务网关，一般用Spring Gateway、Spring Zuul实现。根据请求派发到不同的controller所在的机器。

小问题：怎么计算单机nginx的并发量或者说请求量？
nginx能处理多少请求，一般而言和CPU，内存并没有直接的关系。而是和网络带宽有关系。举个例子，比如单机100M的网卡，那么其实际的流量为12.5M/s，如果一个请求是数据库包是1KB，那么每秒能处理12.5 *1024  = 1W个请求左右

###### 1.2 多机房

多机房，实际上而言，就是1个机房复制了多份。比如北京机房，上海机房。每个机房部署的业务应该是完全相同的。不可能说不同的业务部署在不同的机房。

那么此时，有以下几个问题：

1. 怎么对多个机房的LVS群来做负载均衡呢？或者说，由谁来对多个机房的LVS群来做负载均衡呢？
   答：DNS，一个域名可以绑定多个IP，通过动态DNS解析，来做不同机房LVS群的负载均衡。

2. 如何实现多个机房的数据同步问题?

   答：首先对数据进行分类，像有些游戏，它是分区的，不同的区的数据不一致。但无论如何有些数据，全部机房都要共享的，即每个机房都需要保存一样的数据，对于这种情况，为了保证速度和效率，可以考虑拉专线。比如：建立北京机房到深圳机房的专线。专线是直连的，不像普通的网络带宽，普通的网络带宽，是存在多个节点转发的，比如移动转到联通，联通转电信等等。

###### 1.3 FastFDS集群

实际有些业务中，用户往往需要上传一些资源，比如用户的头像，用户的歌曲，用户的图片。这些上传的资源，不可能存数据库，也不可能存在tomcat中，一般都是放到一个静态文件集群里。

静态文件集群专门用于存放静态文件，包括js，css图片，还有用于上传的一些文件


###### 1.4 CDN

当存在多机房服务时，如果业务需要用到静态资源，每次都直接从FastFDS静态文件集群获取的话，那离得远的机房获取起来就太慢了。所以需要缓存，于是就出现了CDN服务器。

每个CDN节点由两部分组成：负载均衡设备和高速缓存服务器

负载均衡设备：负责每个节点中各个Cache的负载均衡，保证节点的工作效率;同时，负载均衡设备还负责收集节点与周围环境的信息，保持与全局负载DNS的通信，实现整个系统的负载均衡。

高速缓存服务器(Cache)：负责存储客户网站的大量信息，就像一个靠近用户的网站服务器一样响应本地用户的访问请求。

通过部署CDN服务器，实现了上海用户访问最近的CDN节点，从CDN缓存上获取相应各类静态资源，大大增加了访问速度。而CDN服务器的源，就是FastFDS静态文件集群。



##### 2.TPS和QPS

TPS和QPS都是指每秒的请求量。但TPS是设计数据库的请求，这种请求才是对性能有真正要求的。